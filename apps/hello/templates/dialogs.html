
{% extends "base.html" %}

{% load staticfiles %}

{% block meta_title %}<title>User chat</title>{% endblock meta_title %}

{% block content_class %}col-md-10{% endblock %}

{% block content %}

<p>Point a second browser onto this URL, login and check for message synchronization.</p>

		<div class="row">
				<pre id="billboard" style="overflow-y: auto; height: 24em; margin-top: 1em;"></pre>
		</div>

		<div class="row">
			<div "form-inline">
				<div class="form-group col-xs-12 col-sm-7">
					<input class="form-control" id="text_message" 
                 type="text" data-sender="{{ request.user.username }}"/>
				</div>
				<div class="form-group col-xs-12 col-sm-5 col-md-4">
	        <button class="btn btn-primary" id="send_message">Send message</button>
	        to
	        <select class="form-control" id="user" style="display: inline-block; width: auto;">
	        {% for user in users %}
		      <option value="{{ user.username }}">{% firstof user.get_full_name user.username %}</option>
	        {% endfor %}
	        </select>
				</div>
			</div>
		</div>

{% endblock content %}

{% block extra_js %}
<script src="{% static "js/bootstrap.min.js" %}"></script>
<script src="{% static "js/ws4redis.js" %}"></script>
<script src="{% static "js/dialogs.js" %}"></script>

<script>
// if you put this code in a separate script then 
// values from TEMPLATE_CONTEXT_PROCESSORS will be unavailable

jQuery(document).ready(function($) {

  chatFocused = true;

  var ws4redis = WS4Redis({
    uri: '{{ WEBSOCKET_URI }}dialogs?subscribe-user',
    receive_message: receiveMessage,
    heartbeat_msg: {{ WS4REDIS_HEARTBEAT }}
  });

  $('#send_message').click(sendMessage);

  $message.keydown(function(event) {
    if (event.keyCode === 13) {
      event.preventDefault();
      sendMessage();
    }
  });

});

</script>
{% endblock extra_js %}
